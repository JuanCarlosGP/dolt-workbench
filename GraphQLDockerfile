FROM --platform=linux/arm64/v8 node:18.18.0 as builder

RUN mkdir build
WORKDIR build

COPY . .

WORKDIR packages/graphql-server
RUN yarn install --frozen-lockfile
RUN yarn build

FROM --platform=linux/arm64/v8 node:18.18.0-alpine3.18

RUN mkdir -p /usr/dolt-workbench
WORKDIR /usr/dolt-workbench
COPY --from=builder /build/. .

WORKDIR /usr/dolt-workbench/packages/graphql-server
ENV NODE_ENV development
EXPOSE 9002
CMD [ "npm", "start" ]
